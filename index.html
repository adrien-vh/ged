<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="">
        <meta name="author" content="">

        <title>Ged</title>

        <!-- UIkit CSS -->
        <!--<link rel="stylesheet" href="vendor/uiKit/uikit.min.css" />-->
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/bootstrap/bootstrap.css">
        <link rel="stylesheet" href="vendor/bootstrap/ie10-viewport-bug-workaround.css">
        <link rel="stylesheet" href="css/jqcloud.css">
        <link rel="stylesheet" href="vendor/tokenize/tokenize2.css">
        <link rel="stylesheet" href="vendor/fileUploader/jquery.fileuploader.css">
        <link rel="stylesheet" href="css/styles.css">

        <!-- jQuery is required -->
        <script src="vendor/jQuery/jquery.min.js"></script>
        <script src="vendor/bootstrap/bootstrap.js"></script>
        <script src="vendor/bootstrap/ie10-viewport-bug-workaround.js"></script>

        <!-- UIkit JS -->
        <!--<script src="vendor/uiKit/uikit.js"></script>
        <script src="vendor/uiKit/uikit-icons.min.js"></script>-->
        <script src="vendor/vue/vue.min.js"></script>
        <script src="vendor/vue/vue-router.js"></script>
        <script src="vendor/jqCloud/jqcloud.min.js"></script>
        <script src="vendor/typeAhead/typeahead.bundle.min.js"></script>
        <script src="vendor/tokenize/tokenize2.js"></script>
        <script src="vendor/fileUploader/jquery.fileuploader.min.js"></script>
        <script src="vendor/ckeditor/ckeditor.js"></script>
        <script src="vendor/ckeditor/adapters/jquery.js"></script>
        <script src="js/donnees.js"></script>
        <script src="js/main.js"></script>
    </head>
    <body>
        <div id="gedInstance" v-bind:class="{ 'gris': utilisateur.loggedIn }">
            <nav class="navbar navbar-inverse navbar-fixed-top" v-show="utilisateur.loggedIn">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#">Ged</a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            <router-link tag="li" to="/recherche"><a>Recherche</a></router-link>
                            <router-link tag="li" to="/tags"><a>Tags</a></router-link>
                            <router-link tag="li" to="/arborescence"><a>Arborescence</a></router-link>
                            <router-link tag="li" to="/ajout"><a>Ajout</a></router-link>
                            <router-link tag="li" to="/configuration"><a>Configuration</a></router-link>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a>{{ utilisateur.nom }}</a></li>
                            <li><a href="#" v-on:click="onDisconnect">[Déconnexion]</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="container-fluid">
                <div class="row" v-bind:class="{ 'col-md-6': utilisateur.loggedIn }">
                    <div class="contenu">
                        <router-view></router-view>
                    </div>
                </div>
            </div>
        </div>
        <!--<div class="uk-container-small uk-align-center">
            
        </div>-->
            
        <script type="text/x-template" id="page-login-template">
            <div>
                <div id="titreAccueil">g<span>ed</span></div>
                <div id="contLoginForm">
                    <h2>Connexion</h2>
                    <form id="loginForm" v-on:submit.prevent="onSubmit" action="foo">

                        <div class="input-group" v-bind:class="{ 'has-error': !loginValide && !loginEnCours }">
                            <div class="input-group-addon"><i class="fa fa-user" aria-hidden="true"></i></div>
                            <input type="text" id="inputEmail" class="form-control" placeholder="Login" required autofocus v-model="login">
                        </div>
                        <div class="input-group" v-bind:class="{ 'has-error': !loginValide && !loginEnCours }">
                            <div class="input-group-addon"><i class="fa fa-key" aria-hidden="true"></i></div>
                            <input type="password" id="inputPassword" class="form-control" placeholder="Mot de passe" required v-model="password">
                        </div>
                        <button 
                            class="btn btn-lg btn-primary btn-block" type="submit" 
                            v-on:click="onSubmit" 
                            v-bind:class="{ 'disabled': loginEnCours }">
                            S'identifier
                        </button>
                    </form>
                </div>
            </div>
        </script> 
        
        <script type="text/x-template" id="page-recherche-template">
            <div>
                <in-recherche v-on:change="lanceRecherche"></in-recherche>
            </div>
        </script>
        <script type="text/x-template" id="page-tags-template">
            <nuage-tags :tags="tags"></nuage-tags>
        </script>
        <script type="text/x-template" id="page-arborescence-template">
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-home" aria-hidden="true"></i></a></li>
                <li><a href="#">Procédures</a></li>
                <li><a href="#">Applications</a></li>
                <li class="active">Ciril</li>
            </ol>
        </script>
        <script type="text/x-template" id="page-doc-template">
            <div id="affichageDoc">
                <b>{{ infos.type }}</b>
                <span v-for="categorie in categories">
                     - 
                    <em class="texteGris">{{ categorie.nom }} : </em>
                    {{ categorie.mot }}
                </span>
                <em class="texteGris">Tags : </em>
                <span v-for="tag in tags">{{tag}}, </span>
            
                <h1>{{ infos.titre }}</h1>
                {{ infos.auteur }} le {{ $root.formatDate(infos.date) }}
                <!-- Doc {{ $route.params.num_doc }} -->
            </div>
        </script>
        <script type="text/x-template" id="page-ajout-template">
            <div>
                <form>
                    <div class="row">
                        <div class="form-group col-md-3" v-bind:class="{ 'has-error': !typeValide }">
                            <label>Type</label>
                            <select class="form-control" v-model="type" @change="chargeCategories">
                                <option value="">Choisir un type</option>
                                <option v-for="leType in types" :value="leType.num_tag">{{ leType.mot }}</option>
                            </select>
                        </div>
                        <div v-for="categorie in categories" class="form-group col-md-3" v-bind:class="{ 'has-error': !categorie.estValide }">
                            <label>{{ categorie.nom }}</label>
                            <in-tag-categorie :num_categorie="categorie.num_categorie" v-model="categorie.valeurChoisie"></<in-tag-categorie>
                        </div>
                    </div>
                    <div class="form-group" v-bind:class="{ 'has-error': !titreValide }" >
                        <label>Titre</label>
                        <input type="text" class="form-control" placeholder="Titre..." v-model="titre" >
                    </div>
                    <div class="form-group">
                        <label>Tags</label>
                        <in-tags v-model="tags"></in-tags>
                    </div>
                    <div class="btn-group mb-5" role="group">
                        <button type="button" class="btn btn-default" v-bind:class="{ 'active': !isWiki }" v-on:click="isWiki = false">Fichier</button>
                        <button type="button" class="btn btn-default" v-bind:class="{ 'active': isWiki }" v-on:click="isWiki = true">Wiki</button>
                    </div>
                    <div v-show="!isWiki">
                        <div>
                            <in-fichier v-model="inFichier" :valide="fichierValide"></in-fichier>
                        </div>
                    </div>
                    <div v-show="isWiki">
                        <div>
                            <in-wiki v-model="inWiki"></in-wiki>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary btn-lg center-block mt-5" v-on:click="sauve"><i class="fa fa-floppy-o" aria-hidden="true"></i> Enregistrer</button>
                </form>
            </div>
        </script>
        <script type="text/x-template" id="page-configuration-template">
            <div>
                <ul class="nav nav-pills mb-5">
                    <li role="presentation" v-bind:class="{ 'active': pageActive == 1 }"><a href="#" v-on:click.prevent="pageActive = 1">Utilisateur</a></li>
                    <li role="presentation" v-bind:class="{ 'active': pageActive == 2 }"><a href="#" v-on:click.prevent="pageActive = 2">Types de documents et catégories liées</a></li>
                    <li role="presentation" v-bind:class="{ 'active': pageActive == 3 }"><a href="#" v-on:click.prevent="pageActive = 3">Catégories</a></li>
                </ul>
                <div v-show="pageActive == 1">
                    <table class="table table-condensed">
                        <thead>
                            <tr>
                                <th>Utilisateur</th>
                                <th style="width: 150px;">Droit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="utilisateur in utilisateurs">
                                <td>{{ utilisateur.nom }}</td>
                                <td>
                                <button class="btn btn-info btn-sm btn-block"
                                        v-if="utilisateur.niveau == 0" 
                                        v-on:click="majUtilisateur(utilisateur, $event)">
                                    Lecteur
                                </button>
                                <button class="btn btn-warning btn-sm btn-block"
                                        v-if="utilisateur.niveau == 1"
                                        v-on:click="majUtilisateur(utilisateur, $event)">
                                        Rédacteur
                                </button>
                                <button class="btn btn-danger btn-sm btn-block"
                                        v-if="utilisateur.niveau == 2"
                                        v-on:click="majUtilisateur(utilisateur, $event)">
                                        Admin
                                </button>
                            </tr>
                        </tbody>
                    </table>
                    <label>Nouvel utilisateur</label>
                    <in-utilisateur v-on:input="submitUtilisateur" v-model="nouvelUtilisateur" inactifs></in-utilisateur>
                </div>
                <div v-show="pageActive == 2">
                    <table class="table table-condensed">
                        <thead>
                            <tr>
                                <th>Types</th>
                                <th>Catégories</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="type in types">
                                <td>{{ type.nom }}</td>
                                <td>
                                    <div v-for="categorie in type.categories">{{ categorie }}</div>

                                    <form class="form-inline">
                                        <select class="form-control input-sm" v-model="type.nouvelleCategorie">
                                            <option v-for="categorie in categories" :value="categorie.num_categorie">{{ categorie.nom }}</option>
                                        </select>
                                        <a href="#" v-on:click.prevent="submitCategorieType(type, $event)"><i class="fa fa-plus-circle fa-lg" aria-hidden="true"></i></a>
                                    </form>
                                    
                                    
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <form class="form-inline">
                                        <input 
                                            class="form-control input-sm"
                                            type="text"
                                            placeholder="Nouveau type"
                                            v-model="nouveauType"
                                            v-on:keyup.enter="submitType"
                                        >
                                        <a href="" v-on:click="submitType"><i class="fa fa-plus-circle fa-lg" aria-hidden="true"></i></a>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div v-show="pageActive == 3">
                    <div class="ml-1" v-for="categorie in categories">
                        {{ categorie.nom }}
                    </div>
                    <br>
                    <form class="form-inline">
                        <input 
                            class="form-control input-sm"
                            type="text"
                            placeholder="Nouvelle catégorie"
                            v-model="nouvelleCategorie"
                            v-on:keyup.enter="submitCategorie"
                        >
                        <a href="" v-on:click.prevent="submitCategorie"><i class="fa fa-plus-circle fa-lg" aria-hidden="true"></i></a>
                    </div>
                </div>
            </div>
        </script>
    </body>
</html>
